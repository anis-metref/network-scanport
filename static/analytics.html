<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics - Network Scanner Pro</title>
    <link rel="stylesheet" href="./styles.css">
    <link rel="stylesheet" href="./database-styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/date-fns@2.29.3/index.min.js"></script>
</head>
<body>
    <div id="app">
        <!-- Modern Header -->
        <header class="modern-header">
            <div class="header-container">
                <div class="brand" onclick="window.location.href='index.html'" style="cursor: pointer;">
                    <div class="brand-icon">
                        <div class="shield-icon"></div>
                    </div>
                    <div class="brand-text">
                        <h1>Network Scanner Pro</h1>
                        <span class="brand-subtitle">Dashboard Analytics</span>
                    </div>
                </div>
                <div class="header-actions">
                    <div class="status-indicator">
                        <div class="status-dot active"></div>
                        <span>Système protégé</span>
                    </div>
                    <div class="header-menu">
                        <button class="btn-header active">
                            <div class="analytics-icon-small"></div>
                            Analytics
                        </button>
                        <button class="btn-header" onclick="window.location.href='network-map.html'">
                            <div class="map-icon-small"></div>
                            Carte
                        </button>
                        <button class="btn-header" onclick="window.location.href='history.html'">
                            <div class="history-icon-small"></div>
                            Historique
                        </button>
                        <button class="btn-icon" onclick="window.location.href='index.html'">
                            <div class="home-icon"></div>
                        </button>
                    </div>
                </div>
            </div>
        </header>

        <!-- Analytics Page -->
        <main class="dashboard">
            <!-- Page Title Section -->
            <section class="page-title-section">
                <div class="page-title-content">
                    <h1>Dashboard Analytics</h1>
                    <p>Métriques et analyses détaillées de vos scans réseau</p>
                    <div class="analytics-controls">
                        <select id="time-range" onchange="updateTimeRange()">
                            <option value="1h">Dernière heure</option>
                            <option value="24h" selected>Dernières 24h</option>
                            <option value="7d">7 derniers jours</option>
                            <option value="30d">30 derniers jours</option>
                        </select>
                    </div>
                </div>
            </section>
        </main>

            <!-- Analytics Grid -->
            <section class="analytics-content">
                <!-- KPI Cards -->
                <div class="quick-actions">
                    <div class="action-card">
                        <div class="card-icon hosts-icon"></div>
                        <div class="card-content">
                            <h3>Hôtes Scannés</h3>
                            <p><span id="total-hosts-scanned">0</span> appareils analysés</p>
                            <div class="status-badge positive" id="hosts-trend">+12%</div>
                        </div>
                    </div>
                    
                    <div class="action-card">
                        <div class="card-icon services-icon"></div>
                        <div class="card-content">
                            <h3>Services Détectés</h3>
                            <p><span id="total-services">0</span> services actifs</p>
                            <div class="status-badge positive" id="services-trend">+8%</div>
                        </div>
                    </div>
                    
                    <div class="action-card">
                        <div class="card-icon scans-icon"></div>
                        <div class="card-content">
                            <h3>Scans Effectués</h3>
                            <p><span id="total-scans">0</span> analyses complétées</p>
                            <div class="status-badge neutral" id="scans-trend">--</div>
                        </div>
                    </div>
                    
                    <div class="action-card">
                        <div class="card-icon performance-icon"></div>
                        <div class="card-content">
                            <h3>Temps Moyen</h3>
                            <p><span id="avg-scan-time">0s</span> par analyse</p>
                            <div class="status-badge negative" id="time-trend">-5%</div>
                        </div>
                    </div>
                </div>

                <!-- Charts Row 1 -->
                <div class="charts-row">
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3>Activité Réseau en Temps Réel</h3>
                            <div class="chart-legend">
                                <span class="legend-item"><span class="legend-dot online"></span>Hôtes En Ligne</span>
                                <span class="legend-item"><span class="legend-dot offline"></span>Hôtes Hors Ligne</span>
                            </div>
                        </div>
                        <canvas id="network-activity-chart"></canvas>
                    </div>
                    
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3>Distribution des Services</h3>
                            <div class="chart-info">Top services détectés</div>
                        </div>
                        <canvas id="services-distribution-chart"></canvas>
                    </div>
                </div>

                <!-- Charts Row 2 -->
                <div class="charts-row">
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3>Performance des Scans</h3>
                            <div class="chart-info">Temps de réponse par hôte</div>
                        </div>
                        <canvas id="scan-performance-chart"></canvas>
                    </div>
                    
                    <div class="chart-container">
                        <div class="chart-header">
                            <h3>Tendances Hebdomadaires</h3>
                            <div class="chart-info">Évolution sur 7 jours</div>
                        </div>
                        <canvas id="weekly-trends-chart"></canvas>
                    </div>
                </div>

                <!-- Network Health -->
                <div class="network-health">
                    <h3>Santé du Réseau</h3>
                    <div class="health-metrics">
                        <div class="health-item">
                            <div class="health-label">Disponibilité</div>
                            <div class="health-bar">
                                <div class="health-fill" style="width: 98%" data-value="98"></div>
                            </div>
                            <div class="health-value">98%</div>
                        </div>
                        
                        <div class="health-item">
                            <div class="health-label">Sécurité</div>
                            <div class="health-bar">
                                <div class="health-fill security" style="width: 85%" data-value="85"></div>
                            </div>
                            <div class="health-value">85%</div>
                        </div>
                        
                        <div class="health-item">
                            <div class="health-label">Performance</div>
                            <div class="health-bar">
                                <div class="health-fill performance" style="width: 92%" data-value="92"></div>
                            </div>
                            <div class="health-value">92%</div>
                        </div>
                    </div>
                </div>

                <!-- Historique des Scans -->
                <div class="scan-history-section">
                    <div class="history-header">
                        <h3>Historique des Scans</h3>
                        <div class="history-controls">
                            <input type="text" id="history-search" placeholder="Rechercher..." onkeyup="searchHistory()">
                            <button class="btn-orange btn-danger-orange" onclick="clearAllHistory()">
                                Tout effacer
                            </button>
                        </div>
                    </div>
                    <div id="scan-history-list" class="history-list">
                        <div class="loading-history">Chargement de l'historique...</div>
                    </div>
                </div>

                <!-- Bookmarks Section -->
                <div class="bookmarks-section">
                    <div class="bookmarks-header">
                        <h3>Favoris de Scan</h3>
                        <button class="btn-primary" onclick="showAddBookmarkModal()">
                            <div class="add-icon"></div>
                            Ajouter un favori
                        </button>
                    </div>
                    <div id="bookmarks-list" class="bookmarks-grid">
                        <div class="loading-bookmarks">Chargement des favoris...</div>
                    </div>
                </div>
            </div>
        </main>

        <!-- Add Bookmark Modal -->
        <div id="add-bookmark-modal" class="modal" style="display: none;">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Ajouter un Favori</h3>
                    <button class="modal-close" onclick="hideAddBookmarkModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="bookmark-form" onsubmit="saveBookmark(event)">
                        <div class="form-group">
                            <label for="bookmark-name">Nom du favori</label>
                            <input type="text" id="bookmark-name" required placeholder="Ex: Réseau bureau">
                        </div>
                        <div class="form-group">
                            <label for="bookmark-target">Cible</label>
                            <input type="text" id="bookmark-target" required placeholder="Ex: 192.168.1.0/24">
                        </div>
                        <div class="form-group">
                            <label for="bookmark-description">Description</label>
                            <textarea id="bookmark-description" placeholder="Description optionnelle"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="bookmark-scan-type">Type de scan</label>
                            <select id="bookmark-scan-type">
                                <option value="quick">Rapide</option>
                                <option value="range">Approfondi</option>
                                <option value="full">Complet</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="bookmark-ports">Ports spécifiques</label>
                            <input type="text" id="bookmark-ports" placeholder="Ex: 22,80,443">
                        </div>
                        <div class="modal-actions">
                            <button type="button" class="btn-secondary" onclick="hideAddBookmarkModal()">Annuler</button>
                            <button type="submit" class="btn-primary">Sauvegarder</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Session Details Modal -->
        <div id="session-details-modal" class="modal" style="display: none;">
            <div class="modal-content large-modal">
                <div class="modal-header">
                    <h3>Détails de la Session</h3>
                    <button class="modal-close" onclick="hideSessionDetailsModal()">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="session-details-content">
                        <!-- Contenu dynamique -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="./app.js"></script>
    <script>
        // Initialize analytics page
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('=== INITIALISATION PAGE ANALYTICS ===');
            
            if (!window.analyticsManager) {
                window.analyticsManager = new AnalyticsManager();
            }
            
            try {
                await window.analyticsManager.initialize();
                console.log('Page analytics initialisée avec succès');
            } catch (error) {
                console.error('Erreur lors de l\'initialisation:', error);
            }
        });
    </script>
</body>
</html>